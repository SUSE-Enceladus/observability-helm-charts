{{- define "stackstate.api.persistentvolumeclaim.txLog" -}}
{{- $storageClass := include "suse-observability.features.get" (dict "key" "storeTransactionLogsToPVC.storageClass" "context" . ) }}
metadata:
  name: {{ template "common.fullname.short" . }}-api-txlog
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: {{ include "suse-observability.features.get" (dict "key" "storeTransactionLogsToPVC.volumeSize" "context" . )}}
{{- if ne $storageClass "<no value>" }}
  storageClassName: {{ $storageClass }}
{{- end }}
{{- end -}}

{{- if and (include "suse-observability.features.enabled" (dict "key" "storeTransactionLogsToPVC.enabled" "context" .)) (include "suse-observability.features.enabled" (dict "key" "server.split" "context" .)) }}
{{- $commonPVC := fromYaml (include "common.persistentvolumeclaim" .) -}}
{{- $stackstateApiPVCTxLog := fromYaml (include "stackstate.api.persistentvolumeclaim.txLog" .) -}}
{{- toYaml (merge $stackstateApiPVCTxLog $commonPVC) -}}
{{- end -}}
