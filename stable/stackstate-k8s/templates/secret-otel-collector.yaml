{{- define "stackstate.open-telemetry-collector.secret" -}}
metadata:
  name: stackstate-otel-collector
data:
  API_KEY: {{ index .Values.opentelemetry "apiKey" | default .Values.global.receiverApiKey | b64enc | quote }}
{{- end -}}

{{- if .Values.opentelemetry.enabled -}}

{{- $commonSecret := fromYaml (include "common.secret" .) -}}
{{- $stackstateOtelSecret := fromYaml (include "stackstate.open-telemetry-collector.secret" .) -}}
{{- toYaml (merge $stackstateOtelSecret $commonSecret) -}}
{{- end -}}
